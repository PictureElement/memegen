<!doctype html>
<html lang="en">
  <head>
    <title>MemeGen</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Easily add text to images. Generate your own memes.">
    <meta name="author" content="PictureElement (Marios Sofokleous)">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script defer src="https://buttons.github.io/buttons.js"></script>
    <script defer src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  </head>
  <body>
    <!--<button class="back-to-top-button" aria-label="back to top">â†‘</button>-->
    <div class="inset-box-shadow cover-container d-flex h-100 p-3 mx-auto flex-column bg-gradient text-center">
      <header>
        <img width="75" class="logo" draggable="false" src="images/logo.svg" alt="site logo">
        <h1 class="header-logo text-gradient">MemeGen</h1>
        <p class="text-white">
          MemGen is a simple and easy to use meme generator. Upload your image
          to generate funny memes instantly. Don't have an internet connection?
          Don't worry we got you covered. The app works even when offline!
        </p>
        <p class="lead">
          <a class="github-button" href="https://github.com/PictureElement" data-size="large" aria-label="Follow @PictureElement on GitHub">
            Follow @PictureElement
          </a>
          <a class="github-button" href="https://github.com/PictureElement/memegen" data-icon="octicon-star" data-size="large" aria-label="Star PictureElement/memegen on GitHub">
            Star
          </a>
        </p>
      </header>
    </div>

    <main>
      <div class="container rounded bg-gray box-shadow">
        <div class="row">
          <div class="canvas-wrapper col-sm-8">
            <canvas id="c" border-secondary rounded">
              Sorry, the &lt;canvas&gt; element is not supported by your browser
            </canvas>
          </div>
          <div class="col-sm-4">
            <form>
              <div class="form-group">
                <label for="image-file">Upload image</label>
                <input type="file" id="image-file" class="form-control-file" name="image-file" accept=".jpg, .jpeg, .png">
              </div>
              <div class="form-group">
                <input type="text" class="form-control form-control-sm" id="topLine" placeholder="Top Line">
              </div>
              <div class="form-group">
                <input type="text" class="form-control form-control-sm" id="bottomLine" placeholder="Bottom Line">
              </div>
              <div class="form-group">
                <input type="number" min="1" max="200" class="form-control form-control-sm" id="fontSize" placeholder="Font Size (1-200)">
              </div>
              <a id="save" class="btn btn-primary" role="button">Save</a>
            </form>
          </div>
        </div>
      </div>
    </main>
    <footer class="text-center p-4">
      <a href="https://pictureelement.github.io/portfolio-2/">
        <i class="fa fa-code" style="font-size:20px;color:#ad5389;" aria-hidden="true"></i> with <i class="fa fa-heart" style="font-size:16px;color:#ad5389;" aria-hidden="true"></i> by PictureElement
      </a>
    </footer>
    <script>
      var canvas = document.getElementById('c');

      // Check for canvas support
      if (canvas.getContext) {

        // Access the rendering context
        var context = canvas.getContext('2d');
      
        function redrawMeme (image, topText, bottomText) {
          // Erase any previously drawn content
          context.clearRect(0, 0, canvas.width, canvas.height);

          // Draw image
          if (image != null) {
            // Use the intrinsic size of image in CSS pixels
            canvas.width = image.naturalWidth;
            canvas.height = image.naturalHeight;
            context.drawImage(image, 0, 0);
          }

          // Text styling
          context.font = fontSize + "px Arial";
          context.textAlign = 'center';
          context.strokeStyle = 'black';
          context.lineWidth = 4;
          context.fillStyle = 'white';
          
          // Draw top line
          if (topText != null) {
            context.strokeText(topText, canvas.width / 2, fontSize);
            context.fillText(topText, canvas.width / 2, fontSize);
          }

          // Draw bottom line
          if (bottomText != null) {
            context.strokeText(bottomText, canvas.width / 2, canvas.height - fontSize / 2);
            context.fillText(bottomText, canvas.width / 2, canvas.height - fontSize / 2);
          }
        }

        function textChangeHandler (e) {
          var id = e.target.id;
          var text = e.target.value;
          if (id == "topLine") {
            topLine = text;
          }
          else {
            bottomLine = text;
          }
          // Redraw canvas
          redrawMeme(currentImage, topLine, bottomLine);
        }

        function fileSelectHandler () {
          // File list
          var fileList = this.files;

          // Create a new instance of FileReader
          var reader = new FileReader();

          reader.onload = function (e) {
            var dataURL = reader.result;
            // Set the src property for the current image using the data URL
            currentImage.src = reader.result;
            currentImage.onload = function () {
              console.log('Image has been loaded');
              // Redraw canvas
              redrawMeme(currentImage, topLine, bottomLine);
            }
          }

          // Produce a data URL for the file 
          reader.readAsDataURL(fileList[0]); 
        }

        // Initialization
        var topLine = "TOP LINE";
        var bottomLine = "BOTTOM LINE";
        var fontSize = 100;
        var currentImage = new Image();
        currentImage.src = "images/placeholder.jpg";
        // The callback will be called when the image has finished loading
        currentImage.onload = function() {
          redrawMeme(currentImage, topLine, bottomLine);
        }

        // Execute textChangeHandler() when a user writes something in the <input> field
        document.getElementById("topLine").addEventListener("input", textChangeHandler);

        // Execute textChangeHandler() when a user writes something in the <input> field
        document.getElementById("bottomLine").addEventListener("input", textChangeHandler);

        // Execute callback when a user writes something in the <input> field
        document.getElementById("fontSize").addEventListener("input", function (e) {
          fontSize = e.target.value;
          // Redraw canvas
          redrawMeme(currentImage, topLine, bottomLine);
        });

        // Execute fileSelectHandler() when the user uploads an image
        document.getElementById("image-file").addEventListener('change', fileSelectHandler, false);

        // Execute callback when the user clicks on Save button
        document.getElementById("save").addEventListener('click', function () {
          // Returns a data URI containing a representation of the image in the 
          // format specified by the type parameter (defaults to PNG)
          this.href = canvas.toDataURL();
          this.download = "mymeme.png";
        }, false);
      }
    </script>
  </body>
</html>
